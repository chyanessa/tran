<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è©é­‚ Lyric Vision | æ„å¢ƒç¿»è­¯å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@500;700&family=Noto+Sans+TC:wght@300;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --muji-bg: #F5F5F3; --muji-red: #7F1111; --muji-gray: #555555; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--muji-bg); color: #333; margin: 0; padding-bottom: 90px; }
        .serif { font-family: 'Noto Serif TC', serif; }
        .glass-nav { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
        .muji-card { background: white; border-radius: 2px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        .loading-shimmer { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <header class="p-6 bg-white border-b border-gray-100 sticky top-0 z-50 flex justify-between items-center">
        <div>
            <h1 class="serif text-xl font-bold tracking-[0.2em] text-gray-800">è©é­‚</h1>
            <p class="text-[9px] text-gray-400 uppercase tracking-widest">Lyric Vision Translator</p>
        </div>
        <button onclick="toggleModal('settings-modal')" class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center text-gray-400">
            <i class="fa-solid fa-sliders"></i>
        </button>
    </header>

    <main class="p-4 max-w-xl mx-auto">
        <div id="translator-tab" class="tab-content active">
            <div class="muji-card p-6 mb-6">
                <input type="text" id="song-query" placeholder="æ­Œæ›²åç¨± - æ­Œæ‰‹" 
                       class="w-full border-b border-gray-100 py-3 mb-6 text-lg serif focus:border-red-800 transition-colors bg-transparent">
                
                <div class="mb-6">
                    <label class="text-[10px] text-gray-400 uppercase tracking-widest block mb-2">Original Lyrics</label>
                    <textarea id="raw-lyrics" rows="8" placeholder="åœ¨æ­¤è²¼ä¸Šæ­Œè©åŸæ–‡..." 
                              class="w-full p-4 bg-gray-50 rounded-sm text-sm leading-relaxed focus:bg-white transition-all"></textarea>
                </div>

                <div class="flex items-center gap-3">
                    <select id="lang-select" class="flex-1 bg-gray-100 border-none p-3 rounded-sm text-sm text-gray-600 outline-none">
                        <option value="Japanese">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª (ç‰©å“€/è©©æ„)</option>
                        <option value="Korean">ğŸ‡°ğŸ‡· í•œêµ­ì–´ (æƒ…æ„Ÿå¼µåŠ›)</option>
                        <option value="English">ğŸ‡ºğŸ‡¸ English (ç¯€å¥/é›™é—œ)</option>
                        <option value="Thai">ğŸ‡¹ğŸ‡­ à¸ à¸²à¸©à¸²à¹„à¸—à¸¢ (è¯éº—/æº«æŸ”)</option>
                    </select>
                    <button onclick="translateAction()" id="btn-translate" 
                            class="bg-[#7F1111] text-white px-8 py-3 rounded-sm font-medium hover:bg-black transition-all">
                        æ„Ÿæ‚Ÿç¿»è­¯
                    </button>
                </div>
            </div>

            <div id="result-area" class="hidden">
                <div class="muji-card p-8 border-t-4 border-[#7F1111] relative">
                    <div id="out-header" class="mb-6"></div>
                    <div id="out-lyrics" class="serif text-lg leading-[2.2] text-gray-800 whitespace-pre-wrap mb-8"></div>
                    <div id="out-notes" class="p-4 bg-stone-50 text-xs text-stone-500 rounded leading-relaxed"></div>
                    <button onclick="saveToHistory()" class="mt-6 text-xs text-gray-400 hover:text-red-800 transition-colors">
                        <i class="fa-regular fa-bookmark mr-2"></i>å„²å­˜è‡³æ­·å²ç´€éŒ„
                    </button>
                </div>
            </div>
        </div>

        <div id="history-tab" class="tab-content">
            <h2 class="serif text-xl mb-6 px-2 text-gray-800">æ­·å²ç´€éŒ„</h2>
            <div id="history-list" class="space-y-4"></div>
        </div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 glass-nav border-t border-gray-100 flex justify-around py-4 z-40">
        <button onclick="switchTab('translator')" id="nav-translator" class="flex flex-col items-center gap-1 text-red-800">
            <i class="fa-solid fa-feather-pointed text-lg"></i>
            <span class="text-[10px] font-bold">ç¿»è­¯</span>
        </button>
        <button onclick="switchTab('history')" id="nav-history" class="flex flex-col items-center gap-1 text-gray-400">
            <i class="fa-solid fa-box-archive text-lg"></i>
            <span class="text-[10px] font-bold">æ­·å²</span>
        </button>
    </nav>

    <div id="settings-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm z-[100] flex items-center justify-center p-6">
        <div class="muji-card w-full max-w-sm p-8">
            <div class="flex justify-between items-center mb-6">
                <h3 class="serif font-bold text-lg">å¼•æ“è¨­å®š</h3>
                <button onclick="toggleModal('settings-modal')"><i class="fa-solid fa-xmark text-gray-300"></i></button>
            </div>
            <label class="text-[10px] text-gray-400 block mb-2 uppercase">OpenAI API Key</label>
            <input type="password" id="api-key" placeholder="sk-..." class="w-full border p-3 rounded-sm mb-6 text-sm">
            <button onclick="saveKey()" class="w-full bg-black text-white py-3 rounded-sm text-sm tracking-widest uppercase">ä¿å­˜è¨­å®š</button>
        </div>
    </div>

    <script>
        const store = {
            get: (key) => localStorage.getItem(key),
            set: (key, val) => localStorage.setItem(key, val)
        };

        function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }
        function saveKey() {
            const key = document.getElementById('api-key').value;
            if(key) { store.set('lyric_key', key); toggleModal('settings-modal'); alert('å¯†é‘°å·²å®‰å…¨ä¿å­˜'); }
        }

        function switchTab(name) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(name + '-tab').classList.add('active');
            document.querySelectorAll('nav button').forEach(btn => btn.classList.replace('text-red-800', 'text-gray-400'));
            document.getElementById('nav-' + name).classList.replace('text-gray-400', 'text-red-800');
            if(name === 'history') renderHistory();
        }

        async function translateAction() {
            const key = store.get('lyric_key');
            if(!key) return toggleModal('settings-modal');

            const query = document.getElementById('song-query').value;
            const lyrics = document.getElementById('raw-lyrics').value;
            const lang = document.getElementById('lang-select').value;
            const btn = document.getElementById('btn-translate');

            if(!lyrics) return alert('è«‹è¼¸å…¥æ­Œè©å…§å®¹');

            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i> æ„Ÿæ‚Ÿä¸­';

            const prompt = `ä½ æ˜¯ä¸€ä½ç²¾é€šå¤šèªè¨€çš„æ­Œè©ç¿»è­¯å¤§å¸«ã€‚è«‹å°‡ä»¥ä¸‹${lang}æ­Œè©ç¿»è­¯æˆç¹é«”ä¸­æ–‡ã€‚
            è¦å‰‡ï¼š1.æ„å¢ƒå„ªæ–¼å­—é¢ 2.ä¿ç•™åŸæ–‡ç‰¹æœ‰çš„æƒ…æ„Ÿï¼ˆå¦‚æ—¥æœ¬çš„ç‰©å“€æˆ–æ³°æ–‡çš„æº«æŸ”ï¼‰ 3.ç¿»è­¯éœ€ç²¾ç¾å¦‚è©©ã€‚
            
            è¼¸å‡ºæ ¼å¼è«‹å‹™å¿…ç¬¦åˆä»¥ä¸‹ JSONï¼š
            { "title": "[æ­Œå - æ­Œæ‰‹] [æ›²é¢¨é ä¼°]", "translation": "åŸæ–‡\\nä¸­æ–‡ç¿»è­¯ (äº¤æ›¿å‡ºç¾)", "notes": "è­¯è€…è¨»è§£" }
            
            æ­Œè©åŸæ–‡ï¼š${lyrics}`;

            try {
                const res = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${key}` },
                    body: JSON.stringify({
                        model: "gpt-4-turbo-preview",
                        messages: [{role: "user", content: prompt}],
                        response_format: { type: "json_object" }
                    })
                });
                
                const data = await res.json();
                const result = JSON.parse(data.choices[0].message.content);

                document.getElementById('result-area').classList.remove('hidden');
                document.getElementById('out-header').innerHTML = `<h3 class="text-[#7F1111] font-bold serif">${result.title}</h3>`;
                document.getElementById('out-lyrics').innerText = result.translation;
                document.getElementById('out-notes').innerHTML = `<strong>è­¯è€…è¨»ï¼š</strong><br>${result.notes}`;
                
                window.scrollTo({ top: document.getElementById('result-area').offsetTop - 100, behavior: 'smooth' });
            } catch (e) {
                alert('ç¿»è­¯å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Key æ˜¯å¦æ­£ç¢ºæˆ–ç¶²è·¯ç‹€æ…‹');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'æ„Ÿæ‚Ÿç¿»è­¯';
            }
        }

        function saveToHistory() {
            let history = JSON.parse(store.get('history') || '[]');
            const item = {
                title: document.getElementById('out-header').innerText,
                content: document.getElementById('out-lyrics').innerText,
                notes: document.getElementById('out-notes').innerText,
                time: new Date().toLocaleString()
            };
            history.unshift(item);
            store.set('history', JSON.stringify(history.slice(0, 15)));
            alert('å­˜æª”æˆåŠŸ');
        }

        function renderHistory() {
            const history = JSON.parse(store.get('history') || '[]');
            const list = document.getElementById('history-list');
            if(history.length === 0) { list.innerHTML = '<p class="text-center text-gray-400 py-20 text-xs">å°šç„¡å­˜æª”</p>'; return; }
            list.innerHTML = history.map((h, i) => `
                <div class="muji-card p-5 border-l-2 border-stone-200">
                    <p class="text-[10px] text-stone-300 mb-1">${h.time}</p>
                    <h4 class="serif font-bold text-gray-700 mb-2">${h.title}</h4>
                    <p class="text-xs text-gray-400 line-clamp-2">${h.content}</p>
                    <button onclick="restoreHistory(${i})" class="mt-3 text-[10px] text-red-800 uppercase tracking-widest">è¼‰å…¥å…§å®¹</button>
                </div>
            `).join('');
        }

        function restoreHistory(index) {
            const history = JSON.parse(store.get('history'));
            const item = history[index];
            switchTab('translator');
            document.getElementById('result-area').classList.remove('hidden');
            document.getElementById('out-header').innerHTML = `<h3 class="text-[#7F1111] font-bold serif">${item.title}</h3>`;
            document.getElementById('out-lyrics').innerText = item.content;
            document.getElementById('out-notes').innerText = item.notes;
        }

        // åˆå§‹åŒ– Key é¡¯ç¤º
        if(store.get('lyric_key')) document.getElementById('api-key').value = store.get('lyric_key');
    </script>
</body>
</html>
